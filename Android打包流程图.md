# 📊 Android 打包流程图

## 整体流程概览

```
开始
  ↓
准备环境
  ├─ 安装 Node.js
  ├─ 安装 Android Studio
  ├─ 安装 Android SDK
  └─ 配置环境变量
  ↓
初始化项目
  ├─ npm install
  ├─ npx cap init
  └─ npx cap add android
  ↓
构建应用
  ├─ npm run build
  └─ npx cap sync android
  ↓
打开 Android Studio
  └─ npx cap open android
  ↓
运行/打包
  ├─ 连接设备
  ├─ 点击运行 ▶️
  └─ 或生成 APK
  ↓
完成 ✅
```

---

## 详细流程

### 1️⃣ 环境准备阶段

```
┌─────────────────────────────────────┐
│        安装 Node.js                  │
│  https://nodejs.org/                │
│  验证: node -v                       │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│      安装 Android Studio             │
│  https://developer.android.com/     │
│  包含: SDK, Build Tools, Emulator   │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│        配置环境变量                   │
│  ANDROID_HOME = SDK路径              │
│  Path += platform-tools              │
│  验证: adb version                   │
└─────────────────────────────────────┘
```

### 2️⃣ 项目初始化阶段

```
项目文件夹
    ↓
┌──────────────────────┐
│   npm install        │  ← 安装所有依赖
│   等待 3-5 分钟       │
└──────────────────────┘
    ↓
┌──────────────────────┐
│   npx cap init       │  ← 初始化 Capacitor
│   使用默认配置        │
└──────────────────────┘
    ↓
┌──────────────────────┐
│ npx cap add android  │  ← 添加 Android 平台
│ 创建 android/ 文件夹  │
└──────────────────────┘
```

### 3️⃣ 构建同步阶段

```
源代码 (React)
    ↓
┌──────────────────────┐
│   npm run build      │  ← 编译成静态文件
│   生成 dist/ 文件夹   │
└──────────────────────┘
    ↓
  dist/
    ├─ index.html
    ├─ assets/
    └─ ...
    ↓
┌──────────────────────────┐
│ npx cap sync android     │  ← 同步到 Android
│ 复制文件到 android/      │
└──────────────────────────┘
    ↓
android/
  ├─ app/
  │   └─ src/
  │       └─ main/
  │           └─ assets/
  │               └─ public/  ← Web 文件
  └─ ...
```

### 4️⃣ Android Studio 阶段

```
┌──────────────────────────┐
│ npx cap open android     │  ← 打开 Android Studio
└──────────────────────────┘
    ↓
Android Studio
    ↓
┌──────────────────────────┐
│   Gradle 同步             │  ← 自动执行
│   下载依赖                │
│   等待 2-5 分钟           │
└──────────────────────────┘
    ↓
    ┌─────────────────┐
    │  同步成功？      │
    └────┬────────────┘
         │
    Yes  │  No
    ↓    │    ↓
  继续   │   查看故障排除指南
         │
```

### 5️⃣ 运行测试阶段

```
┌─────────────────────────────┐
│     连接 Android 设备        │
│   或启动模拟器               │
└─────────────────────────────┘
    ↓
┌─────────────────────────────┐
│   启用 USB 调试              │
│   允许调试授权               │
│   验证: adb devices          │
└─────────────────────────────┘
    ↓
┌─────────────────────────────┐
│   在 Android Studio 中       │
│   点击运行按钮 ▶️            │
└─────────────────────────────┘
    ↓
    ┌─────────────────┐
    │  应用安装中...   │
    └─────────────────┘
    ↓
    ┌─────────────────┐
    │  应用启动        │
    └─────────────────┘
    ↓
┌─────────────────────────────┐
│   ✅ 测试所有功能            │
│   - 添加指令                │
│   - 录音                    │
│   - 训练                    │
└─────────────────────────────┘
```

### 6️⃣ 生成 APK 阶段（可选）

```
在 Android Studio 中
    ↓
┌──────────────────────────────┐
│  Build → Build APK(s)        │
└──────────────────────────────┘
    ↓
┌──────────────────────────────┐
│      构建中...                │
│      等待 1-3 分钟            │
└──────────────────────────────┘
    ↓
┌──────────────────────────────┐
│  ✅ APK 生成成功              │
│  位置: android/app/build/    │
│       outputs/apk/debug/     │
│       app-debug.apk          │
└──────────────────────────────┘
    ↓
    分享给其他设备
```

---

## 更新流程（后续修改代码后）

```
修改代码
    ↓
┌──────────────────────┐
│ npm run build        │  ← 重新构建
└──────────────────────┘
    ↓
┌──────────────────────┐
│ npx cap sync android │  ← 同步更新
└──────────────────────┘
    ↓
在 Android Studio 中
点击运行 ▶️
    ↓
✅ 更新完成
```

或使用快捷命令：
```bash
npm run android:sync
```

---

## 决策树：遇到问题怎么办？

```
遇到错误
    ↓
    ┌──────────────────────────┐
    │  是环境配置问题吗？       │
    │  (adb, ANDROID_HOME)     │
    └─────┬───────────────┬────┘
         YES             NO
          ↓               ↓
    查看完整指南        ┌──────────────────┐
    "环境配置"部分      │ 是 Gradle 问题吗？│
                       └─────┬──────────┬──┘
                            YES        NO
                             ↓          ↓
                        清除缓存    ┌────────────────┐
                        重新同步    │ 是构建问题吗？  │
                                   └─────┬──────┬───┘
                                        YES     NO
                                         ↓       ↓
                                    检查代码   查看
                                    重新构建   Logcat
                                              日志
```

---

## 时间估算

### 首次完整流程
```
┌─────────────────────────────────────┐
│ 安装软件            30-60 分钟       │
├─────────────────────────────────────┤
│ 配置环境             5-10 分钟       │
├─────────────────────────────────────┤
│ 安装依赖             3-5 分钟        │
├─────────────────────────────────────┤
│ 初始化项目           2-3 分钟        │
├─────────────────────────────────────┤
│ 构建同步             1-2 分钟        │
├─────────────────────────────────────┤
│ Gradle 同步          2-5 分钟        │
├─────────────────────────────────────┤
│ 运行测试             1-2 分钟        │
├─────────────────────────────────────┤
│ 总计              45-90 分钟         │
└─────────────────────────────────────┘
```

### 后续更新
```
┌─────────────────────────────────────┐
│ 修改代码             按需            │
├─────────────────────────────────────┤
│ 构建同步             1-2 分钟        │
├─────────────────────────────────────┤
│ 运行测试             1 分钟          │
├─────────────────────────────────────┤
│ 总计                2-3 分钟         │
└─────────────────────────────────────┘
```

---

## 关键文件说明

```
项目结构
│
├─ 📄 capacitor.config.ts
│   ↑ Capacitor 配置
│   定义应用 ID、名称等
│
├─ 📄 package.json
│   ↑ 项目依赖
│   包含 Capacitor 相关包
│
├─ 📄 vite.config.ts
│   ↑ 构建配置
│   base: './' 很重要！
│
├─ 📁 dist/
│   ↑ 编译后的 Web 文件
│   npm run build 的输出
│
└─ 📁 android/
    ↑ Android 项目文件夹
    npx cap add android 创建
    │
    ├─ 📁 app/
    │   └─ src/main/
    │       ├─ assets/public/  ← Web 文件位置
    │       ├─ AndroidManifest.xml  ← 权限配置
    │       └─ res/  ← 图标资源
    │
    └─ build.gradle  ← Gradle 配置
```

---

## 成功标志检查清单

```
环境阶段
  ✓ node -v 显示版本号
  ✓ adb version 显示版本号
  ✓ Android Studio 能正常打开

初始化阶段
  ✓ node_modules/ 文件夹存在
  ✓ android/ 文件夹已创建
  ✓ capacitor.config.ts 存在

构建阶段
  ✓ dist/ 文件夹存在且有内容
  ✓ android/app/src/main/assets/public/ 有文件

运行阶段
  ✓ Gradle sync 成功（绿色勾）
  ✓ 设备/模拟器出现在设备列表
  ✓ 应用成功安装到设备
  ✓ 应用能正常打开
  ✓ 所有功能正常工作
```

---

**按照这个流程，你一定能成功！** 🚀
